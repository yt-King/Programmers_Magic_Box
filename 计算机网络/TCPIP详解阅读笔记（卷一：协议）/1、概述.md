# 第一章——概述

> 协议的第一定义：国家事务或外交场合的正式程序或规则系统

## 1.1 体系结构原则

因特网在计算机之间提供了消息通信能力，万维网是使用因特网来通信的具体应用（比如web）

### 1.1.1 分组、连接和数据报

二十世纪六十年代之前，网络的概念主要用于电话通信，一次通话中双方之间需要建立一条线路（最初是一条物理线路，随着科技的发展，电话通信中的物理线路逐渐演变为电路交换网络。电路交换网络通过自动交换机实现电话之间的连接，从而避免了需要物理线路直接连接的限制），这条线路为用户提供一定的贷带宽或容量，以便传输信息。

二十世纪六十年代出现的一个重要概念——**分组交换**思想。分组交换中，包含一定字节数的数字信息“块”（分组）独立通过网络，在传输过程中可以在进行组合然后分解——（多路）复用。分组在到达目的地过程中会在交换设备之间传输，并且路径可变。这样做有两个优点：网络更有弹性；基于**统计复用**可以更好的利用网络链路和交换设备。

>基于统计复用（Statistical Multiplexing）是一种网络通信技术，旨在更好地利用网络链路和交换设备的资源。
>
>通过统计复用，当网络上的连接不同时刻具有不均匀的数据传输需求时，可以更好地利用可用的带宽。它利用了通信流量的统计特性，根据连接的实际数据传输情况，动态地分配带宽资源。这样，在空闲或低负载时，资源可以被其他连接共享，提高了网络的整体效率。

### 1.1.2 端到端论点和命运共享

设计一个大系统的时候，很重要的一个问题是**在什么位置实现某个功能。**

影响TCP/IP协议族设计的的一个重要原则称为**端到端论点**，与之相关的还有一个称为**命运共享**的相关原则：

- "端到端论点"（End-to-End Principle）是一种设计原则，提出了在网络通信中的数据处理应该尽可能地在通信的端点进行，而不是在中间的网络节点进行。这一原则强调网络应该尽量简化，将更多的智能和控制权交给端点设备，而不是依赖于中央控制。这个原则认为重要功能（例如差错控制、加密、交付确认）通常不会在大型体统的低层实现，但是低层可以提供方便端系统工作的功能。

  根据端到端论点，网络中的中间节点（如路由器、交换机等）应该保持简单，只提供基本的转发和传输功能，而具体的数据处理和协议应该由端点设备来完成。这样做的目的是提高网络的可靠性、灵活性和可扩展性。同时，端到端论点还强调保持端点的自治性，使得端点设备能够根据自身需求和特定应用进行自主决策和处理。

- "命运共享"（Sharing Fate）是一个与端到端论点相关的概念。它指的是在网络通信中，数据传输的质量和结果是由通信的端点设备共同决定的，而不仅仅依赖于网络中的中间节点。换句话说，发送方和接收方共同承担了通信的成功和失败的风险。

  命运共享认为，由于网络是一个复杂和不确定的环境，中间节点无法完全控制和保证数据传输的可靠性。因此，发送方和接收方应该共同参与和协作，以确保通信的成功。这可以通过错误检测和纠正、重传机制、流量控制等方式实现。

### 1.1.3 差错控制和流量控制

端到端论点和命运共享建议在应用程序附近或内部实现差错控制。

一个可靠的文件传输应用并不关心交付的文件数据块的顺序，最终将所有块无差错的交付并按照原来的顺序重新组合即可。

## 1.2 设计和实现

实现协议族的常用方案——分层

### 1.2.1 分层

![img](https://typora-imagehost-1308499275.cos.ap-shanghai.myqcloud.com/2023-5/64515_template.png)

### 1.2.2 分层实现中的复用、分解和封装

>分层结构的一个主要优点就是**协议复用**的能力。

<img src="https://typora-imagehost-1308499275.cos.ap-shanghai.myqcloud.com/2023-6/image-20230624102628026.png" alt="image-20230624102628026" style="zoom:67%;" />

封装的本质 ➡️ 每层都将来自上层的数据看成不透明的、无需解释的信息。

互联网的目标之一 ➡️ 对应用隐藏所有关于物理布局（拓扑）和底层协议的异构性的细节。

## 1.3 TCP/IP协议族结构和协议

### 1.3.1 ARPANET 参考模型

ARPANET参考模型的分层最终被TCP/IP协议族采纳，它的结构比OSI模型更简单，但在实现中包括一些特定的协议，并且不适合于常规层次的简化。

>尽管TCP/IP模型相对于OSI模型更简单，但它并不适合于常规层次的简化，因为它是根据具体的需求和实践发展而来的。TCP/IP模型的设计重点是互联网的可扩展性和适应性，因此在实践中进行了一些针对性的调整和改进，以满足实际应用的需求。

<img src="https://typora-imagehost-1308499275.cos.ap-shanghai.myqcloud.com/2023-6/image-20230624105009695.png" alt="image-20230624105009695" style="zoom:67%;" />

TCP/IP模型是互联网的基础，它是一系列网络协议的总称。这些协议可以划分为四层，分别为链路层、网络层、传输层和应用层。

- 链路层：负责封装和解封装IP报文，发送和接受ARP/RARP报文等。
- 网络层：负责路由以及把分组报文发送给目标网络或主机。
- 传输层：负责对报文进行分组和重组，并以TCP或UDP协议格式封装报文。
- 应用层：负责向用户提供应用程序，比如HTTP、FTP、Telnet、DNS、SMTP等。

### 1.3.2 TCP/IP中的复用、分解和封装

下图模拟了如何在在一台Internet主机上对一个PDU进行分解

> Demux："Demux"是"Demultiplex"的简写，它是指在通信或数据处理中，将合并在一起的多路信号或数据流分解为单独的组件或通道的过程。

<img src="https://typora-imagehost-1308499275.cos.ap-shanghai.myqcloud.com/2023-6/image-20230624105758417.png" alt="image-20230624105758417" style="zoom: 67%;" />

### 1.3.3 端口号

在TCP/IP协议族中， 端口号是通过16位无符号整数表示，取值范围从0到65535。

端口号被分为三个范围：

1. 熟知端口（Well-known Ports）：范围从0到1023。这些端口号通常被分配给一些常见的网络服务，例如HTTP（端口号80）、FTP（端口号21）、SSH（端口号22）等。熟知端口具有预留的特殊用途，并且在大多数情况下需要管理员权限才能使用。
2. 注册端口（Registered Ports）：范围从1024到49151。这些端口号可以被应用程序或服务注册并使用，但没有特定的预留用途。许多常见的应用程序和服务都使用注册端口号，例如MySQL数据库（端口号3306）、SMTP（端口号25）等。
3. 动态/私有端口（Dynamic/Private Ports）：范围从49152到65535。这些端口号可以被动态地分配给客户端应用程序或服务，用于临时的通信会话。动态端口通常在操作系统级别自动分配，并且在通信会话结束后释放。

>tips：早起的网络服务大多使用奇数的端口号，这是有历史原因的，这些端口号是从NCP（NCP是网络控制协议，在TCP之前作为APRANET的传输层协议）端口号派生而来的。NCP虽然简单，但不是全双工的，因此每个应用需要两个连接，并为每个应用保留奇偶成对的端口号。当TCP和UDP称为称为标准传输层协议时，每个应用只需要一个端口号，因此来自NCP的奇数端口号被使用。

### 1.3.4 名称、地址和DNS

1. 名称（Name）：在计算机网络中，名称是用来标识特定实体的可识别文本。在互联网上，最常见的名称就是域名（Domain Name）。域名是由一串有层次结构的标签组成，用于标识特定的网站、服务器或网络资源。例如，"example.com"就是一个域名。名称的使用方便于人们记忆和使用，比如使用易于理解和记忆的名称而不是复杂的数字地址。
2. 地址（Address）：地址用于在计算机网络中唯一标识设备或网络资源的位置。在互联网上，最常见的地址类型是IP地址（Internet Protocol Address）。IP地址是一个由数字组成的标识符，用于在网络中准确定位设备或网络节点。IP地址可以是IPv4地址（如192.168.0.1）或IPv6地址（如2001:0db8:85a3:0000:0000:8a2e:0370:7334）。地址的作用是确保数据可以正确路由到目标设备或资源。
3. DNS（Domain Name System）：DNS是一种分布式的命名系统，用于将域名转换为对应的IP地址。它充当了域名和IP地址之间的转换器。当用户输入一个域名时，计算机会向DNS服务器发起查询，获取该域名对应的IP地址。DNS服务器会返回与域名相对应的IP地址，以便进行网络通信。DNS的作用是将人类友好的域名映射到计算机网络中的具体地址，使得网络资源更容易被访问。

总结起来，名称（如域名）是用于人们识别和记忆特定实体的文本标识，地址（如IP地址）是用于在网络中准确定位设备或资源的数字标识，而DNS是用于将名称转换为对应地址的系统，使得网络资源可以被准确访问。

## 1.4 Internet、「内联网（Intranet）」和「外联网（Internet）」

小写字母开头的internet表示**使用常见的协议族互联的几个网络**。大写字母开头的Internet表示**可使用TCP/IP通信的世界范围内的主机集合**。Internet是一个internet，但反过来说是错误的。

- 内联网（Intranet）是指在一个组织或机构内部建立的私有网络。它利用互联网技术和协议来构建局域网（LAN）或广域网（WAN），用于组织内部的通信和资源共享。内联网通常基于TCP/IP协议，并采用类似于互联网的技术和工具，如Web浏览器、电子邮件、文件传输等。内联网提供了一种安全、受控的网络环境，供组织内部的成员共享信息、协作和访问内部资源，但对外部用户来说通常不可访问。

- 外联网（Internet）则指的是全球范围的公共网络，由各种网络和连接设备相互连接而成。它是一个开放的、分布式的网络结构，通过互联网协议（TCP/IP）进行通信。外联网允许全球范围的计算机和网络设备相互连接，用户可以通过互联网访问各种资源，如网站、应用程序、服务等。外联网是一个公共网络，允许全球用户之间的交流和数据传输。

因此，内联网是指组织或机构内部的私有网络，用于内部通信和资源共享；外联网则指的是全球范围的公共网络，用于连接全球用户和资源。内联网和外联网在性质、范围和使用方式上有明显的区别。